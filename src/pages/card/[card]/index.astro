---
import { getSession } from "auth-astro/server";
import Layout from "@/layouts/Layout.astro";
import CardInfo from "@/components/card/CardInfo.svelte";
import { client } from "../../../../client";
import CardMeta from "@/components/card/CardMeta.svelte";
const session = await getSession(Astro.request);

const cardId = Astro.params.card;
let cardData = [];
try {
  cardData = await client.query(
    `
  select Card {
    id,
    number,
    createdAt,
    meme: {
      id,
      img,
      name,
      description
    },
    userId,
    user: {
      name
    },
    auction: {
      price
    }
  }
  filter .id = <uuid>$cardId
  limit 1
`,
    {
      cardId: cardId,
    }
  );
} catch (e) {
  return Astro.redirect("/404");
}

console.log(cardData);
---

<Layout session={session}>
  <CardMeta slot="head" card={cardData[0]} />

  <CardInfo session={session} card={cardData[0]} client:load />
</Layout>
