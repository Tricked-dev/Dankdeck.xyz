---
import { getSession } from "auth-astro/server";
import Layout from "@/layouts/Layout.astro";
import CardInfo from "@/components/card/CardInfo.svelte";
import { client } from "../../../../client";
import CardMeta from "@/components/card/CardMeta.svelte";
import { getCard } from "@/lib/queries";
import type { Card } from "@db/schema";
const session = await getSession(Astro.request);

const cardId = Astro.params.card;
let cardData: Card;
try {
  cardData = await getCard(cardId!);
} catch (e) {
  return Astro.redirect("/404");
}
---

<Layout session={session} title={cardData.meme.name + " #" +cardData.number}>
  <CardMeta slot="head" card={cardData} />

  <CardInfo session={session} card={cardData} client:load />
</Layout>
